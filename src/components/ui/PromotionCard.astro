---
import LightningIcon from "@assets/icons/lightning.svg";
import Modal from "@components/ui/Modal.astro";

const {
  id,
  title,
  subtitle,
  image,
  prices,
  extraOffer,
  conditions,
  expirationDate,
  dateISO,
} = Astro.props;

const modalId = `promo-modal-${id}`;

const priceGridClasses =
  prices.length === 1 ? "grid-cols-1 max-w-xs mx-auto" : "grid-cols-2";
---

<article
  class="flex h-full flex-col overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-xl transition-all duration-500 hover:-translate-y-1 hover:shadow-2xl hover:shadow-teal-500/30"
>
  <!-- Barra de color superior -->
  <div class="h-2 w-full bg-gradient-to-r from-teal-500 to-cyan-500"></div>

  <div class="flex flex-grow flex-col p-6">
    <!-- Encabezado -->
    <header class="mb-5 text-center min-h-[112px]">
      {/* <-- ¡EL CAMBIO ESTÁ AQUÍ! */}
      <h3 class="text-2xl font-bold text-teal-800">
        {title}
      </h3>
      {
        subtitle && (
          <p class="text-md font-semibold text-teal-600">{subtitle}</p>
        )
      }
    </header>

    <!-- Sección de Precios -->
    <div class=`mb-5 grid ${priceGridClasses} gap-4`>
      {
        prices.map((item) => (
          <div class="rounded-lg border border-teal-200 bg-teal-50/50 p-3 text-center">
            <h4 class="mb-2 font-bold text-teal-800">{item.category}</h4>
            <div class="space-y-1">
              {item.details.map((detail) => (
                <p class="text-sm text-gray-700">
                  {detail.type}:
                  <span class="block font-bold text-teal-700 sm:inline-block sm:ml-1">
                    S/ {detail.price}
                  </span>
                </p>
              ))}
            </div>
          </div>
        ))
      }
    </div>

    <!-- Oferta Extra -->
    {
      extraOffer && (
        <div class="mb-5 rounded-r-lg border-l-4 border-orange-500 bg-orange-100 p-3 text-orange-800">
          <p class="font-bold">
            {extraOffer.title}:
            <span
              class={`ml-2 text-xl ${extraOffer.price === "Gratis" ? "text-green-600" : "text-orange-900"}`}
            >
              {extraOffer.price === "Gratis"
                ? "¡Gratis!"
                : `S/ ${extraOffer.price}`}
            </span>
          </p>
        </div>
      )
    }

    <!-- Condiciones -->
    {
      conditions && (
        <div class="mb-5 text-sm text-gray-600">
          <h5 class="mb-1 font-bold text-gray-700">Condiciones:</h5>
          <ul class="list-inside list-disc space-y-1 pl-1">
            {conditions.map((condition) => (
              <li>{condition}</li>
            ))}
          </ul>
        </div>
      )
    }

    <!-- Footer de la tarjeta -->
    <footer class="mt-auto border-t border-gray-200 pt-4">
      <div class="mb-4 text-center text-sm text-gray-500">
        <span class="font-medium">Válido hasta:</span>
        <time datetime={dateISO} class="ml-1">{expirationDate}</time>
      </div>
      <button
        type="button"
        onclick=`document.getElementById('${modalId}').showModal()`
        class="flex w-full items-center justify-center rounded-xl bg-teal-600 py-3 px-6 font-bold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 active:scale-95"
      >
        <LightningIcon class="mr-2 h-5 w-5" />
        Más Información
      </button>
    </footer>
  </div>
</article>

<Modal modalId={modalId}>
  <h3 class="text-2xl font-bold text-teal-800 mb-4 text-center">{title}</h3>
  <img src={image} alt={`Promoción de ${title}`} class="rounded-lg w-full" />
</Modal>
